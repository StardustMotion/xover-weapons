const int XW_COUNTERSHADING_TRACER_AMMO = 5.5;//*XW_AMMOBAR_UNIT;
const int XW_COUNTERSHADING_TRACER_SPD = 30;

actor XWCountershadingTracerWep : BaseXoverWep { 
	weapon.slotNumber 2	
	inventory.icon "CTSDTRCR" obituary "$OB_XWCOUNTERSHADINGTRACER" tag "$TAG_XWCOUNTERSHADINGTRACER"
	states {
		noAmmo: XWAI U 0
			goto super::noAmmo
		select: XWAI U 0 ACS_NamedExecuteWithResult("core_weaponcolor",6755)
			goto super::select
		ready: XWAI U 0
			goto super::ready	
			
		fire: altfire: hold: althold:
			"----" A 0 A_JumpIf(!CallACS("XW Ammo Check", XW_COUNTERSHADING_TRACER_AMMO), "noAmmo")
			goto shoot
		shoot:
			XWAI V 0 ACS_NamedExecuteAlways("XW Ammo Use", 0, XW_COUNTERSHADING_TRACER_AMMO)
			XWAI U 2
			XWAI W 0 A_PlaySoundEx("CNTRSHDS", "Weapon")
			XWAI V 0 A_SpawnItemEx("Countershading Tracer", 0, 8, 28, XW_COUNTERSHADING_TRACER_SPD*cos(pitch), 0, XW_COUNTERSHADING_TRACER_SPD*sin(-pitch), 0, SXF_TRANSFERPITCH)
			XWAC J 0 A_JumpIfInventory("PowerSpreadRune", 1, 1) goto afterShoot
            XWAI V 0 A_SpawnItemEx("Countershading Tracer", 0, 8, 28, XW_COUNTERSHADING_TRACER_SPD*cos(pitch), 0, XW_COUNTERSHADING_TRACER_SPD*sin(-pitch), 20, SXF_TRANSFERPITCH)
			XWAI V 0 A_SpawnItemEx("Countershading Tracer", 0, 8, 28, XW_COUNTERSHADING_TRACER_SPD*cos(pitch), 0, XW_COUNTERSHADING_TRACER_SPD*sin(-pitch), -20, SXF_TRANSFERPITCH)
			
        afterShoot:
            XWAI V 4
            XWAI W 37				
			XWAI V 4
			XWAI U 50
			XWAI U 0 A_Refire
			goto ready}}
			
actor "Countershading Tracer Tic" : item { states {
	pickup: TNT1 A 0 A_JumpIf(args[0] < 175, "increase")  stop
	increase: TNT1 A 0 A_SetArg(0, args[0]+1) 
        stop}}

actor "Countershading Tracer" : proj { radius 8 height 14 speed 52
	+FORCEXYBILLBOARD +CANBOUNCEWATER bouncetype hexen bouncefactor 0.99 +USEBOUNCESTATE
	wallbouncefactor 0.99 +SKYEXPLODE -ALLOWBOUNCEONACTORS -BOUNCEONACTORS
	bouncecount 30 +SEEKERMISSILE reactiontime 210
	args 0,0 // [duration,frame]
	damagetype "CountershadingTracer" damage (30+(args[0]/2.8)) obituary "$OB_XWCOUNTERSHADINGTRACER" states {
		spawn: 
			TNT1 A 2
		going: frame1:
			XWAI Q 0 A_SetArg(1,1)
			XWAI Q 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI Q 0 A_Countdown
			XWAI Q 1 A_GiveInventory("Countershading Tracer Tic")
			XWAI Q 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI Q 0 A_Countdown
			"----" A 0 A_ChangeFlag("USEBOUNCESTATE", 1)			
			XWAI Q 1 A_GiveInventory("Countershading Tracer Tic")
		frame2:
			XWAI Q 0 A_SetArg(1,2)
			XWAI R 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI R 0 A_Countdown
			XWAI R 1 A_GiveInventory("Countershading Tracer Tic")
			XWAI R 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI R 0 A_Countdown
			"----" A 0 A_ChangeFlag("USEBOUNCESTATE", 1)	
			XWAI R 1 A_GiveInventory("Countershading Tracer Tic")
		frame3:
			XWAI Q 0 A_SetArg(1,3)
			XWAI S 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI S 0 A_Countdown
			XWAI S 1 A_GiveInventory("Countershading Tracer Tic")
			XWAI S 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI S 0 A_Countdown
			"----" A 0 A_ChangeFlag("USEBOUNCESTATE", 1)	
			XWAI S 1 A_GiveInventory("Countershading Tracer Tic")
		frame4:
			XWAI Q 0 A_SetArg(1,4)
			XWAI T 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI T 0 A_Countdown
			XWAI T 1 A_GiveInventory("Countershading Tracer Tic")
			XWAI T 0 A_SpawnItemEx("Countershading Tracer Trail",0,0,7)
			XWAI T 0 A_Countdown
			"----" A 0 A_ChangeFlag("USEBOUNCESTATE", 1)	
			XWAI T 1 A_GiveInventory("Countershading Tracer Tic")
			XWAI T 0 
			goto frame1	
		bounce.ceiling: bounce.floor:
			"----" A 0 A_SetPitch(-pitch)
		bounce.wall: 
			"----" A 1 A_ChangeFlag("USEBOUNCESTATE", 0)
			"----" A 0 A_PlaySoundEx("CNTRSHDB", "Weapon")
			"----" A 0 A_SeekerMissile (11+(args[0]/2.4), 12+(args[0]/2.4), SMF_LOOK | SMF_CURSPEED | SMF_PRECISE, 256, 2+(args[0]/21))
			goto nextFrame
		nextFrame: 
			//"----" A 0 A_ChangeVelocity(XW_COUNTERSHADING_TRACER_SPD*cos(pitch), 0,
					//	XW_COUNTERSHADING_TRACER_SPD*sin(-pitch), CVF_REPLACE | CVF_RELATIVE)
			"----" A 0 A_JumpIf(args[1] > 2, "frame34")
			"----" A 0 A_JumpIf(args[1] == 1, "frame2")
			goto frame1
		frame34:
			"----" A 0 A_JumpIf(args[1] == 3, "frame4")
			goto frame1
		
		xdeath: crash: 
			TNT1 A 0 A_PlaySoundEx("MIGHTYHT", "Item")
		death: 
			TNT1 A 0 A_ChangeFlag("NOINTERACTION", 1)
			XWAI XYZ 2	
			stop}}
			
actor "Countershading Tracer Trail" : gfx { +FORCEXYBILLBOARD
	translation "192:192=160:160" xscale 0.5 yscale 1.0 states {
			spawnframe: TNT1 A 2
				DUOR TTTTTTTT 1 A_FadeOut(0.07)
				stop}}			
