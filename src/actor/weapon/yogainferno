const int XW_YOGA_INFERNO_SPEED = 64;
const int XW_YOGA_INFERNO_STANCE_SPEED = 15;

actor XWYogaInfernoWep : BaseXoverWep { 
	weapon.slotNumber 3
	inventory.icon "YOGAIFNO" 	obituary "$OB_XWYOGAINFERNO"	tag "$TAG_XWYOGAINFERNO"
	states {
		noAmmo: XWAI I 0 A_TakeInventory("YogaInfernoStanceLimit", 123)
			XWAI I 0 A_TakeInventory("Yoga Inferno Stance", 1)
			goto super::noAmmo
		select: XWAI I 0 ACS_NamedExecuteWithResult("core_weaponcolor",6754)
			goto super::select
		deselect: XWAI I 0 A_TakeInventory("var8", 0xFF)
			goto super::deselect
		ready: XWAI I 0
			goto super::ready
	
		hold: "----" A 0 A_JumpIfInventory("IsBot", 1, "botInferno") 	goto fire
		fire:  "----" A 0 A_TakeInventory("altfireToken", 1)			goto check
		altfire: althold: "----" A 0 A_GiveInventory("altfireToken", 1) goto check
			
		check: "----" A 0 A_JumpIfInventory("YogaInfernoStanceLimit", 1, "inferno")
			XWAI I 0 A_JumpIf(!CallACS("XW Ammo Check", 4), "noAmmo")
			XWAI I 0 ACS_NamedExecuteAlways("XW Ammo Use", 0, 4)
			XWAI I 0 A_JumpIfInventory("altfireToken", 1, "altStart")
		mainStart:
			XWAI I 0 A_SetArg(0, XW_YOGA_INFERNO_STANCE_SPEED*cos(angle))//velx)
			XWAI I 0 A_SetArg(1, XW_YOGA_INFERNO_STANCE_SPEED*sin(angle))//vely)
			goto infernoBootup
		altStart:
			XWAI I 0 A_SetArg(0, -XW_YOGA_INFERNO_STANCE_SPEED*cos(angle))//velx)
			XWAI I 0 A_SetArg(1, -XW_YOGA_INFERNO_STANCE_SPEED*sin(angle))//vely)
			goto infernoBootup
		infernoBootup:
			TNT1 A 0 A_GiveInventory("Yoga Inferno Stance", 1)
			XWAI I 0 A_PlaySoundEx("misc/magmaflamestart", "Weapon")
			TNT1 A 0 ACS_NamedExecuteWithResult("core_stopplayer", 0, 1)
			XWAI I 0 ACS_NamedExecuteWithResult("core_nogravityplayer", 0, true)
			TNT1 A 0 A_ChangeFlag("NOGRAVITY", true) // for clientside
			XWAI I 0 A_Stop			
			XWAI IIJ 1			
			TNT1 A 0 A_GiveInventory("var8", 2)
			XWAI K 0 A_JumpIfInventory("IsBot", 1, "botInferno")
		inferno:
			XWAI K 0 A_JumpIfInventory("YogaInfernoStanceLimit", 40, "end")
			XWAI K 0 A_GiveInventory("YogaInfernoStanceLimit", 1)
			XWAI K 2 A_GiveInventory("Yoga Inferno Spit")
			XWAI K 1 A_WeaponReady(WRF_DISABLESWITCH)
			XWAI K 0 A_GiveInventory("YogaInfernoStanceLimit", 1)
			XWAI K 0 A_JumpIfInventory("YogaInfernoStanceLimit", 40, "end")
			XWAI K 2 A_GiveInventory("Yoga Inferno Spit")
			XWAI K 1 A_WeaponReady(WRF_DISABLESWITCH)
			goto end
		end:
			XWAI I 0 A_WeaponReady(WRF_NOFIRE | WRF_NOSWITCH)
			TNT1 A 0 ACS_NamedExecuteWithResult("core_stopplayer", 0, 0)
			XWAI I 0 A_TakeInventory("altfireToken", 1)
			TNT1 A 0 A_TakeInventory("Yoga Inferno Stance", 1)
			XWAI I 0 A_TakeInventory("var8", 10)
			XWAI I 0 ACS_NamedExecuteWithResult("core_nogravityplayer", 0, false)
			XWAI K 4 A_TakeInventory("YogaInfernoStanceLimit", 999)
			XWAI J 2 A_ClearReFire // for bots
			XWAI I 14
			goto ready
			
		botInferno:
			XWAI K 0 A_JumpIfInventory("YogaInfernoStanceLimit", 40, "end")
			XWAI K 0 A_GiveInventory("YogaInfernoStanceLimit", 1)
			XWAI K 2 A_GiveInventory("Yoga Inferno Spit")
			XWAI K 0 A_Refire
			loop}}
			
actor "Yoga Inferno Stance" : PowerSpeed { powerup.duration 80 } // 2*stanceLimit
actor YogaInfernoStanceLimit : var8 { inventory.maxamount 40 }

actor "Yoga Inferno Spit" : item { states {
		pickup: 
			TNT1 A 0 A_GiveInventory("var8", 1)
			TNT1 A 0 A_JumpIfInventory("var8", 2, "attack")
			TNT1 A 0 A_SpawnItemEx("Yoga Inferno Flame", 0, 8, 28, XW_YOGA_INFERNO_SPEED*cos(pitch), 0, XW_YOGA_INFERNO_SPEED*sin(-pitch))
			XWAC J 0 A_JumpIfInventory("PowerSpreadRune", 1, "spreadFlame")
			stop
		spreadFlame:
			TNT1 A 0 A_SpawnItemEx("Yoga Inferno Flame", 0, 8, 28, XW_YOGA_INFERNO_SPEED*cos(pitch), 0, XW_YOGA_INFERNO_SPEED*sin(-pitch),20)
			TNT1 A 0 A_SpawnItemEx("Yoga Inferno Flame", 0, 8, 28, XW_YOGA_INFERNO_SPEED*cos(pitch), 0, XW_YOGA_INFERNO_SPEED*sin(-pitch),-20)
			stop
		attack:
			TNT1 A 0 A_PlaySoundEx("misc/magmaflameloop", "Weapon")
			TNT1 A 0 A_SpawnItemEx("Yoga Inferno Flame Damager", 0, 8, 28, XW_YOGA_INFERNO_SPEED*cos(pitch), 0, XW_YOGA_INFERNO_SPEED*sin(-pitch))
			XWAC J 0 A_JumpIfInventory("PowerSpreadRune", 1, "spreadAttack") goto end
		spreadAttack:
			TNT1 A 0 A_SpawnItemEx("Yoga Inferno Flame Damager", 0, 8, 28, XW_YOGA_INFERNO_SPEED*cos(pitch), 0, XW_YOGA_INFERNO_SPEED*sin(-pitch),20)
			TNT1 A 0 A_SpawnItemEx("Yoga Inferno Flame Damager", 0, 8, 28, XW_YOGA_INFERNO_SPEED*cos(pitch), 0, XW_YOGA_INFERNO_SPEED*sin(-pitch),-20)
		end:
			XWAI K 0 A_TakeInventory("var8", 10)
			TNT1 A 0 A_JumpIfInventory("altfireToken", 1, "juke")
		standard:
			TNT1 A 0 A_ChangeVelocity(args[0],args[1],0,CVF_REPLACE)
			stop
		juke:
			TNT1 A 0 A_ChangeVelocity(-args[0],-args[1],0,CVF_REPLACE)
			stop }}	

	
// would client-side the flame sprite but it needs to stop upon hitting enemy proto shield, etc
actor "Yoga Inferno Flame" : proj { 
	radius 12 height 24 speed 64
	damage (0) damagetype "YogaInferno" obituary "$OB_XWYOGAINFERNO" +FORCEXYBILLBOARD +DONTSPLASH
	states { 
		spawn: TNT1 A 2
			XWAI LMLML 1
			stop}}
				
actor "Yoga Inferno Flame Damager" : "Yoga Inferno Flame" {
	damage (12) +HITTRACER -DONTSPLASH
	states { 
		xdeath: crash: TNT1 A 1 A_ChangeFlag("NOINTERACTION", 1)
				// (:
				//TNT1 A 0 A_JumpIf(CallACS("XW", XW_IS_SAME_TEAM), "death")
				TNT1 A 0 A_ReArrangePointers(AAPTR_TRACER, AAPTR_NULL, AAPTR_TARGET)
				TNT1 A 0 A_GiveToTarget("Yoga Inferno Scorch", 1)
		death: TNT1 A 0 A_SpawnItemEx("OilPitIgnite", 0, 0, 8)
				stop}}
				
		
		
		
		
		
// --------------- SCORCH EFFECT --------------- //
	
actor "Yoga Inferno Scorch" : item { states {
	pickup: 
		TNT1 A 0 A_JumpIfInventory("Yoga Inferno Scorch Count", 1, "reset")
		TNT1 A 0 A_SpawnItemEx("Yoga Inferno Scorch Watcher")
		TNT1 A 0 A_GiveInventory("Yoga Inferno Scorch Effect")
	reset:
		TNT1 A 0 A_GiveInventory("Yoga Inferno Scorch Count", 4)
		stop}}
		
actor "Yoga Inferno Scorch Count" : var8 { inventory.maxamount 4 } // * 3 tics

actor "Yoga Inferno Scorch Watcher" : watcher { 
	states {
		spawn: TNT1 A 0
			TNT1 A 3 A_GiveToTarget("Yoga Inferno Scorch Flame Summon", 1)
			TNT1 A 0 A_TakeFromTarget("Yoga Inferno Scorch Count", 1)
			//TNT1 A 0 A_JumpIf(CallACS("core_targetexists")==0,"end")
			TNT1 A 0 A_JumpIfInTargetInventory("Yoga Inferno Scorch Count", 1, "spawn")
		remove: 
			TNT1 A 0 A_TakeFromTarget("Yoga Inferno Scorch Effect", 1)
			stop }}
			
actor "Yoga Inferno Scorch Effect" : Powerup { powerup.duration 0x7FFFFFFA
		Powerup.Colormap 0.439, 0.0313, 0.0313,      0.847, 0.659, 0.0 }
		
actor "Yoga Inferno Scorch Flame Summon" : item {
	states {
		pickup: TNT1 A 0 A_SpawnItemEx("Yoga Inferno Scorch Flame",random(-3,3),random(-3,3),4,0,0,6)
			stop}}

actor "Yoga Inferno Scorch Flame" : "XW CS Frame" { alpha 0.5 scale 3.75
	states {	
		otherPOV: "----" A 0 A_FadeIn(0.5)
		clientSidePOV: XWAI NOP 2 A_FadeOut(0.10)
			stop}}
			
			