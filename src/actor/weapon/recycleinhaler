const int XW_RECYCLER_INHALER_RANGE = 666;
const int XW_RECYCLER_INHALER_PART = XW_RECYCLER_INHALER_RANGE/8;

const int XW_RECYCLER_INHALER_PIRATE_1 = (XW_RECYCLER_INHALER_RANGE/5);
const int XW_RECYCLER_INHALER_PIRATE_2 = ((XW_RECYCLER_INHALER_RANGE*2)/5);
const int XW_RECYCLER_INHALER_PIRATE_3 = ((XW_RECYCLER_INHALER_RANGE*3)/5);
const int XW_RECYCLER_INHALER_PIRATE_4 = ((XW_RECYCLER_INHALER_RANGE*4)/5);

actor XWRecycleInhalerWep : BaseXoverWep { 
	weapon.slotNumber 4
	inventory.icon "RECLINLR"   obituary "$OB_XWRECYCLEINHALER" tag "$TAG_XWRECYCLEINHALER" 
	states {
		noAmmo: DSTS B 0
			goto super::noAmmo
		select: DSTS B 0 ACS_NamedExecuteWithResult("core_weaponcolor",30)
			goto super::select
        deselect:
			"----" A 0 A_TakeInventory("varBool", 1)
			"----" A 0 A_TakeInventory("var8", 0xFF)
			goto super::deselect
		ready: DSTS B 0
			goto super::ready
			
			
		altfire: althold: "----" A 0 A_GiveInventory("altfireToken")
		fire: hold:
			"----" A 0 A_JumpIfInventory("Recycle Inhaler Cooldown", 1, "ready")
			DSTS B 0 A_JumpIf(!CallACS("XW Ammo Check", 4), "noAmmo")
		pre:
			DSTS C 0 A_TakeInventory("var8", 0xFF)
			DSTS C 0 A_TakeInventory("varBool", 1)
			DSTS B 0 ACS_NamedExecuteAlways("XW Ammo Use", 0, 4)
			//DSTS B 0 A_SpawnItemEx("Recycle Inhaler Pirate",0,8,10,0,0,0,0,SXF_TRANSFERPITCH) //
			DSTS BBC 1 
			DSTS B 0 A_PlaySoundEx("RECLINLR", "Weapon")
			DSTS B 0 A_SpawnItemEx("Recycle Inhaler",28,8,0, 0,0,0, 0, SXF_ABSOLUTEANGLE)
			XWAC J 0 A_JumpIfInventory("PowerSpreadRune", 1, "spreadDamager") goto succ
		spreadDamager:
			DSTS B 0 A_SpawnItemEx("Recycle Inhaler",28,8,0, 0,0,0, 20, SXF_ABSOLUTEANGLE)
			DSTS B 0 A_SpawnItemEx("Recycle Inhaler",28,8,0, 0,0,0, -20, SXF_ABSOLUTEANGLE)
		succ:
			DSTS D 0 A_GiveInventory("var8", 1)
			DSTS DD 0 A_SpawnItemEx("Recycle Inhaler Particle", cos(pitch+random(-12,12))*XW_RECYCLER_INHALER_RANGE, 8, sin(-pitch+random(-12,12))*XW_RECYCLER_INHALER_RANGE, 0,0,0, random(-17,17))
			DSTS D 0 A_SpawnItemEx("Recycle Inhaler Pull", 0, 8, -35, 0, 0, 0, 0, SXF_TRANSFERPITCH, 0, TID-1000)
			XWAC J 0 A_JumpIfInventory("PowerSpreadRune", 1, "succSpread") goto cuss
		succSpread:
			DSTS DD 0 A_SpawnItemEx("Recycle Inhaler Particle", cos(pitch+random(-12,12))*XW_RECYCLER_INHALER_RANGE, 8, sin(-pitch+random(-12,12))*XW_RECYCLER_INHALER_RANGE, 0,0,0, random(-37,-3))
			DSTS DD 0 A_SpawnItemEx("Recycle Inhaler Particle", cos(pitch+random(-12,12))*XW_RECYCLER_INHALER_RANGE, 8, sin(-pitch+random(-12,12))*XW_RECYCLER_INHALER_RANGE, 0,0,0, random(3,37))
			DSTS D 0 A_SpawnItemEx("Recycle Inhaler Pull", 0, 8, -35, 0, 0, 0, -20, SXF_TRANSFERPITCH, 0, TID-1000)
			DSTS D 0 A_SpawnItemEx("Recycle Inhaler Pull", 0, 8, -35, 0, 0, 0, 20, SXF_TRANSFERPITCH, 0, TID-1000)
		cuss:
			DSTS D 2
			DSTS D 0 A_JumpIfInventory("varBool", 1, "cd")
			DSTS D 0 A_JumpIfInventory("var8", 16, "cd")
			DSTS D 0 A_JumpIfInventory("altfireToken", 1, "cd")
			DSTS D 0 A_ReFire("succ")
		cd:
			DSTS D 0 A_TakeInventory("altfireToken", 1)
			DSTS D 0 A_TakeInventory("var8", 0xFFFF)
			DSTS D 0 A_TakeInventory("varBool", 1)
			DSTS D 2 
			DSTS C 2
			DSTS C 0 A_GiveInventory("Recycle Inhaler Cooldown")
			DSTS B 0 A_ReFire
			goto ready}}
			
actor "Recycle Inhaler Cooldown" : Powerup { powerup.duration 24 }
	
actor "Recycle Inhaler" : watcher { states {
	spawn: TNT1 A 0 nodelay a_setmass(angle)
	main: TNT1 A 0 A_Warp(AAPTR_TARGET,28,8,0,mass,WARPF_NOCHECKPOSITION)
		TNT1 A 2 A_SpawnItemEx("Recycle Inhaler Damager")
		TNT1 A 0 A_JumpIfInTargetInventory("varBool", 1, "end")
		TNT1 A 0 A_JumpIfInTargetInventory("var8", 1, "main")
		goto end}}

actor "Recycle Inhaler Damager" : proj { damagetype "RecycleInhaler" 
	height 55 radius 42 damage (24) obituary "$OB_XWRECYCLEINHALER" +DONTREFLECT +DONTBLAST +HITTRACER
	states { spawn: TNT1 A 0
				stop
			xdeath: crash: 
				TNT1 A 0 A_GiveToTarget("varBool", 1)
				TNT1 A 0 A_CheckFlag("ISMONSTER", "monsterDrop", AAPTR_TRACER)
				stop
			monsterDrop: 
				TNT1 A 0 A_RearrangePointers(AAPTR_TRACER, AAPTR_DEFAULT, AAPTR_DEFAULT) 
				TNT1 A 0 A_GiveToTarget("Recycle Inhaler Monster Drop")
				stop}}
				

actor "Recycle Inhaler Pull" : watcher { states {
	spawn:
		TNT1 A 0
		TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pull Part", XW_RECYCLER_INHALER_PART*cos(pitch), 0, XW_RECYCLER_INHALER_PART*sin(-pitch),0,0,0,0,0,0,TID)
		TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pull Part", (3*XW_RECYCLER_INHALER_PART)*cos(pitch), 0, (3*XW_RECYCLER_INHALER_PART)*sin(-pitch),0,0,0,0,0,0,TID)
		TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pull Part", (5*XW_RECYCLER_INHALER_PART)*cos(pitch), 0, (5*XW_RECYCLER_INHALER_PART)*sin(-pitch),0,0,0,0,0,0,TID)
		TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pull Part", (7*XW_RECYCLER_INHALER_PART)*cos(pitch), 0, (7*XW_RECYCLER_INHALER_PART)*sin(-pitch),0,0,0,0,0,0,TID)
		stop}}
		
		// script 247 with xy/z range separate, and possible to drag to caller's target
		// arg1 [0,499]x[0,1] strength and (should drag to targetTID ? rather than self)
		// arg2 xyRange
		// arg3 zRange
        // ^ ???
		
actor "Recycle Inhaler Pull Part" : proj { 
	// XW_RECYCLER_INHALER_PART*2 || *1
	height 126 radius 83 damage (0) states { 
		spawn: TNT1 AA 0
			/*ICES B 0 a_spawnitemex("Blast Missile Smoke",0,-83,63)
			ICES B 0 a_spawnitemex("Blast Missile Smoke",0,83,63)
			ICES B 2 a_spawnitemex("Blast Missile Smoke",0,0,126)*/
			stop
		xdeath: crash: TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pull Checker", 0, 0, 
                XW_RECYCLER_INHALER_PART,0,0,0,0,0,0,TID)
			stop}}
		
actor "Recycle Inhaler Pull Checker" : watcher { states {
	spawn: TNT1 A 0
		TNT1 A 0 A_RadiusGive("XW TID Data", XW_RECYCLER_INHALER_PART, RGF_MONSTERS | RGF_PLAYERS, TID+1)
		TNT1 A 0 A_RadiusGive("Recycle Inhaler Pull Handler", XW_RECYCLER_INHALER_PART, RGF_MONSTERS | RGF_PLAYERS)
		stop}}
	
actor "Recycle Inhaler Pull Handler" : item {
	states {
		pickup: TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteWithResult("XW", XW_PULL_TO_TID, 6)
			TNT1 A 0 A_TakeInventory("XW TID Data")
			stop}}
	
	
	
	
	
	
	
	
	
	
actor "Recycle Inhaler Reward" : item { states {
	pickup: TNT1 A 0 A_PlaySoundEx("RECLITEM", "SoundSlot6")
		TNT1 A 0 A_SpawnItemEx("Recycle Inhaler R-Tank", 60, 0, 28, 7*cos(pitch), 0, 8+7*sin(-pitch))
		TNT1 AA 0 A_GiveInventory("Recycle Inhaler SubReward")
		stop}}
		
actor "Recycle Inhaler SubReward" : item { states {
	pickup: TNT1 A 0 A_Jump(256, "low", "mid", "high") stop
	low: TNT1 A 0 A_Jump(256, "ammoS", "ammoS", "ammoM") stop
	mid: TNT1 A 0 A_Jump(256, "ammoM", "item") stop
	high: TNT1 A 0 A_Jump(256, "ammoL", "item", "item", "item", "item") stop
	ammoS: TNT1 A 0 A_SpawnItemEx("WeaponEnergy", 60, random(-22,38), 28, 7*cos(pitch), random(-4,4), 8+7*sin(-pitch))		stop
	ammoM: TNT1 A 0 A_SpawnItemEx("BigWeaponEnergy", 60, random(-22,38), 28, 7*cos(pitch), random(-4,4), 8+7*sin(-pitch))		stop
	ammoL: TNT1 A 0 A_SpawnItemEx("MegaWeaponEnergy", 60, random(-22,38), 28, 7*cos(pitch), random(-4,4), 8+7*sin(-pitch))		stop
	// 66% wep 33% assist
	item: TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Random", 60, random(-22,38), 28, 7*cos(pitch), random(-4,4), 8+7*sin(-pitch)) stop}}

actor "Recycle Inhaler R-Tank" : BaseMM8BDMItem { inventory.pickupmessage "$PU_XWRTANK" scale 2.0
	states { 
		SpawnLoop: EBAL F 0 
            EBAL E 0
            EBAL E 0 A_JumpIf(tid!=0, 2)
            EBAL E 0 Thing_ChangeTID(0,999)
		idle: EBAL E 6
			XWAP O 6
			loop
		pickup: TNT1 A 0 ACS_NamedExecuteWithResult("core_HealScript",100)
			TNT1 A 0 A_PlaySoundEx("RECLITNK", "SoundSlot7")
			stop}}

actor "Recycle Inhaler Random" : watcher {
    states { spawn: TNT1 A 1 nodelay ACS_NamedExecuteWithResult("XW", 44) stop }}

actor "Recycle Inhaler Monster Drop" : item { states { 
	pickup: TNT1 A 0 A_JumpIfHealthLower(1, "drop") stop
	drop: TNT1 A 0 A_PlaySoundEx("RECLITEM", "SoundSlot6")
		TNT1 A 0 A_Jump(256, "ammo", "ammo", "hp") stop
	ammo: TNT1 A 0 A_Jump(256, "ammoS", "ammoM") stop
	ammoS: TNT1 A 0 A_SpawnItemEx("WeaponEnergy", 0, 0, 28, 0, 0, 10) stop
	ammoM: TNT1 A 0 A_SpawnItemEx("BigWeaponEnergy", 0, 0, 28, 0, 0, 10) stop
	hp: TNT1 A 0 A_Jump(256, "hpS", "hpS", "hpM") stop
	hpS: TNT1 A 0 A_SpawnItemEx("SmallHealth", 0, 0, 28, 0, 0, 10) stop
	hpM: TNT1 A 0 A_SpawnItemEx("BigHealth", 0, 0, 28, 0, 0, 10) stop }}
	
	
		
actor "Recycle Inhaler Particle" : proj { damage (0) +NOINTERACTION
	+FORCEXYBILLBOARD reactiontime 7 scale 7.0 states {
		spawn: TNT1 A 0
		main:
			XWAC O 0 A_FaceTarget(0, 180)
			XWAC O 0 A_ChangeVelocity(10*cos(pitch+2), 0, 10*sin(pitch+2), CVF_RELATIVE)
			XWAC O 2 A_JumpIfCloser(128, "end")
			TNT1 A 0 A_Countdown
			loop}}
		

// PropBlower :)
				/*
DamageType RecycleInhalerPirate { Factor 0 }
// speed RHRANGE/2
actor "Recycle Inhaler Pirate" : watcher {
	states {
		Spawn: TNT1 A 0
			TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pirate Hitbox", XW_RECYCLER_INHALER_PIRATE_1 * cos(pitch), 0, XW_RECYCLER_INHALER_PIRATE_1 * sin(-pitch))
			TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pirate Hitbox", XW_RECYCLER_INHALER_PIRATE_2 * cos(pitch), 0, XW_RECYCLER_INHALER_PIRATE_2 * sin(-pitch))
			TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pirate Hitbox", XW_RECYCLER_INHALER_PIRATE_3 * cos(pitch), 0, XW_RECYCLER_INHALER_PIRATE_3 * sin(-pitch))
			TNT1 A 0 A_SpawnItemEx("Recycle Inhaler Pirate Hitbox", XW_RECYCLER_INHALER_PIRATE_4 * cos(pitch), 0, XW_RECYCLER_INHALER_PIRATE_4 * sin(-pitch))
			stop}}
		
actor "Recycle Inhaler Pirate Hitbox" : proj { +DONTREFLECT +DONTBLAST damage (1) damagetype "RecycleInhalerPirate"
	radius 67 height 80 +NOINTERACTION states {
		spawn: TNT1 A 0
			TNT1 A 0
			TNT1 A 1 A_ChangeFlag("NOINTERACTION", 0)
			stop}}*/
			