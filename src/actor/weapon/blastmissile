actor XWBlastMissileWep : BaseXoverWep { 
	weapon.SlotNumber 5
	inventory.icon "BLSTMISL" 	obituary "$OB_XWBLASTMISSILE"	tag "$TAG_XWBLASTMISSILE"
	states {
		noAmmo: XWAD J 0
			goto super::noAmmo
	    select: XWAD J 0 ACS_NamedExecuteWithResult("core_weaponcolor",6743)
			goto super::select
		ready: XWAD J 0
			goto super::ready
		altfire:
			XWAD J 0 A_GiveInventory("altfireToken")
		fire:
			XWAD J 0 A_JumpIf(!CallACS("XW Ammo Check", 3), "noAmmo")
			goto missileShoot
		missileShoot:
			XWAD K 0 ACS_NamedExecuteAlways("XW Ammo Use", 0, 3)
			XWAD K 0 A_PlaySoundEx("misc/sunstarwrathpillar","Weapon")
			XWAD K 0 A_SpawnItemEx("Blast Missile", 0, 8, 22, 10*cos(pitch), 0, 10*sin(-pitch), 0, SXF_TRANSFERPITCH)
			XWAC J 0 A_JumpIfInventory("PowerSpreadRune", 1, "spread") goto end
        spread:
            XWAD K 0 A_SpawnItemEx("Blast Missile", 0, 8, 22, 10*cos(pitch), 0, 10*sin(-pitch), 20, SXF_TRANSFERPITCH)
            XWAD K 0 A_SpawnItemEx("Blast Missile", 0, 8, 22, 10*cos(pitch), 0, 10*sin(-pitch), -20, SXF_TRANSFERPITCH)
        end:
            XWAD JKL 3
			XWAD L 0 A_JumpIfInventory("altfireToken", 1, "altRelease")
		hold:
			XWAD L 1 A_JumpIfInventory("BlastMissileFlag", 1, "released")
			XWAD L 0 A_Refire
			goto released
		altRelease:
			XWAD L 1 A_TakeInventory("altfireToken")
		released:
			XWAD L 0 A_GiveInventory("BlastMissileFlag")
			XWAD L 0 A_ClearReFire
			XWAD LK 3
			XWAD J 28
			XWAD J 0 A_WeaponReady
			goto ready}}
			
actor "Blast Missile" : proj { 
    damagetype "BlastMissile" damage (5) obituary "$OB_XWBLASTMISSILE" 
	height 16 reactiontime 50 radius 16 states {
			spawn: TNT1 A 0
				TNT1 A 0 A_SpawnItemEx("Blast Missile Smoke", random(-4,4), random(-4,4), 4)
				XWAD M 3
				XWAD NO 3
			going:
				XWAD M 0 A_ChangeVelocity(4*cos(pitch), 0, 4*sin(-pitch), CVF_RELATIVE)
				XWAD M 0 ACS_NamedExecuteWithResult("core_targetyawpitch",1)
				XWAD M 0 A_SpawnItemEx("Blast Missile Smoke", random(-4,4), random(-4,4), 4)				
				XWAD MMM 1 A_JumpIfInTargetInventory("BlastMissileFlag", 1, "death")				
				XWAD N 0 ACS_NamedExecuteWithResult("core_targetyawpitch",1)
				XWAD N 0 A_ChangeVelocity(4*cos(pitch), 0, 4*sin(-pitch), CVF_RELATIVE)				
				XWAD NNN 1 A_JumpIfInTargetInventory("BlastMissileFlag", 1, "death")				
				XWAD O 0 ACS_NamedExecuteWithResult("core_targetyawpitch",1)
				XWAD O 0 A_ChangeVelocity(4*cos(pitch), 0, 4*sin(-pitch), CVF_RELATIVE)				
				XWAD OOO 1 A_JumpIfInTargetInventory("BlastMissileFlag", 1, "death")				
				XWAD O 0 A_ScaleVelocity(0.5)
				XWAD O 0 A_Countdown
				//TNT1 A 0 A_JumpIf(CallACS("core_targetexists")==0,"death")
				loop
			death: TNT1 A 0 A_Explode(62, 144, 0, 0, 32)
					TNT1 A 0 A_GiveToTarget("BlastMissileFlag")
					TNT1 A 0 A_PlaySoundEx("misc/sunstarexplode", "Weapon")
					TNT1 A 1 A_SpawnItemEx("ExplosionEffect4",0,0,12)
					stop}}
					
actor BlastMissileFlag : Powerup { powerup.duration 13 }
					
actor "Blast Missile Smoke" : gfx { +FORCEXYBILLBOARD states {
	spawnframe: TNT1 A 0
		XWAD PQRST 2
		stop}}